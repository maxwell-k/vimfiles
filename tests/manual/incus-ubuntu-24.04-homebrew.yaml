description: Incus profile for testing with Ubuntu 24.05 Noble and homebrew
config:
  user.vendor-data: |
    #cloud-config
    package_upgrade: true
    package_update: true
    packages:
      - openssh-server
      - zsh
      # https://docs.brew.sh/Homebrew-on-Linux
      - build-essential
      - procps
      - curl
      - file
      - git
    runcmd:
      - [mkdir, --parents, /home/maxwell-k/.local/bin]
      - - chown
        - maxwell-k:maxwell-k
        - /home/maxwell-k/.local
        - /home/maxwell-k/.local/bin
    write_files:
      - path: /etc/zsh/zshenv
        content: |
          # /etc/zsh/zshenv: system-wide .zshenv file for zsh(1).
          #
          # This file is sourced on all invocations of the shell.
          # If the -f flag is present or if the NO_RCS option is
          # set within this file, all other initialization files
          # are skipped.
          #
          # This file should contain commands to set the command
          # search path, plus other important environment variables.
          # This file should not contain commands that produce
          # output or assume the shell is attached to a tty.
          #
          # Global Order: zshenv, zprofile, zshrc, zlogin

          if [[ -z "$PATH" || "$PATH" == "/bin:/usr/bin" ]]
          then
                  export PATH="/usr/local/bin:/usr/bin:/bin:/usr/games"
          fi

          # Above is the default taken from Ubuntu 24.04.1 LTS
          # Below is a customisation to add ~/.local/bin to PATH
          export PATH="$HOME/.local/bin:$PATH"
      - path: /etc/ansible/hosts
        content: |
          ::1 ansible_connection=local ansible_python_interpreter=auto_silent
      - path: /home/maxwell-k/.zshrc
        content: |
          bindkey -v
        owner: maxwell-k:maxwell-k
        permissions: "0644"
        defer: true
    users:
      - name: maxwell-k
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /usr/bin/zsh
        ssh_authorized_keys:
          - >
            ssh-ed25519
            AAAAC3NzaC1lZDI1NTE5AAAAIOnexLmfscxCK5QsBTR8adsxcmXJcu0BnEQzx68B7UgL
            codeberg.org/maxwell-k

#
# tests/manual/incus-ubuntu-24.04-homebrew.yaml
# Copyright 2025 Keith Maxwell
# SPDX-License-Identifier: CC0-1.0
