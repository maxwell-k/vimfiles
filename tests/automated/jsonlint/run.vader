" tests/automated/jsonlint/run.vader
" Copyright 2021 Keith Maxwell
" SPDX-License-Identifier: MPL-2.0
"
" see :help ale-development
Before:
  let g:original_buffer = bufnr('%')
  let b:ale_linters = ['jsonlint']  " otherwise jq also reports issues

Given json (Invalid JSON with an extra trailing comma):
  {
    "key1": "value1",
    "key2": "value2",
  }

Execute(Run the linter):
  ALELint
  call ale#test#WaitForJobs(2000)
  " sometimes the linter must be run a second time
  if len(getloclist(bufwinid(g:original_buffer))) == 0
    call ale#test#WaitForJobs(2000)
  endif

Then (At least one issue is found):
  AssertEqual 1, len(getloclist(bufwinid(g:original_buffer)))

After:
  unlet! g:original_buffer
